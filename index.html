<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rancang Bangun Pemantauan Kematangan Buah Pisang Cavendish dan Perubahan Warna Pada Daun Secara Real-Time Berbasis IoT</title>
    <!-- Google Fonts: Poppins for headings and body, more modern feel -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <style>
      /* Global Variables for easier theme management (Burgundy Theme) */
      :root {
        --primary-color: #800020; /* Burgundy */
        --primary-dark: #600018; /* Darker Burgundy */
        --primary-light: #b03060; /* Lighter/Softer Burgundy */
        --secondary-color: #d4af37; /* Gold for contrast */
        --background-light: #fdfdfd; /* Very light background */
        --background-dark: #f5f5f5; /* Slightly darker background */
        --text-dark: #333333;
        --text-light: #666666;
        --card-bg: #ffffff;
        --shadow-light: 0 4px 15px rgba(0, 0, 0, 0.08);
        --shadow-medium: 0 8px 25px rgba(0, 0, 0, 0.15);
        --border-radius-sm: 8px;
        --border-radius-md: 12px;
        --border-radius-lg: 15px;
      }

      /* General Body Styles */
      body {
        font-family: "Poppins", sans-serif; /* Modern font */
        margin: 0;
        padding: 0;
        background-color: var(--background-light);
        color: var(--text-dark);
        line-height: 1.7; /* Improved readability */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow-x: hidden; /* Prevent horizontal scroll */
      }

      /* Header Styles */
      header {
        background-color: var(--primary-color);
        background-image: linear-gradient(to right, var(--primary-color), var(--primary-dark)); /* Burgundy gradient */
        color: white;
        padding: 18px 25px;
        text-align: center;
        box-shadow: var(--shadow-light);
        position: sticky;
        top: 0;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all 0.3s ease;
      }
      header.scrolled {
        box-shadow: var(--shadow-medium);
        padding: 15px 25px; /* Slightly shrink on scroll */
      }
      header h1 {
        font-family: "Poppins", sans-serif;
        font-size: 1.6em;
        margin: 0;
        font-weight: 600;
        flex-grow: 1;
        text-align: center;
        letter-spacing: 0.5px;
      }

      /* Hamburger Menu Icon */
      .hamburger-menu {
        font-size: 2em;
        cursor: pointer;
        color: white;
        display: none;
        margin-right: 20px;
        transition: transform 0.2s ease;
      }
      .hamburger-menu:hover {
        transform: scale(1.15);
        color: var(--primary-light); /* Lighter Burgundy on hover */
      }

      /* Logout Button */
      .logout-btn {
        padding: 10px 18px;
        background-color: #a02020; /* Darker red for logout */
        color: white;
        border: none;
        border-radius: 50px; /* Fully rounded */
        cursor: pointer;
        font-size: 1em;
        font-weight: 500;
        transition: all 0.3s ease;
        display: none;
        margin-left: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .logout-btn:hover {
        background-color: #801010;
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
      }

      /* Sidebar Navigation */
      .sidebar {
        height: 100%;
        width: 0;
        position: fixed;
        z-index: 101;
        top: 0;
        left: 0;
        background-color: #3a3a3a; /* Darker sidebar for good contrast with Burgundy */
        overflow-x: hidden;
        transition: 0.5s cubic-bezier(0.7, 0, 0.3, 1); /* Smooth custom easing */
        padding-top: 80px;
        box-shadow: 3px 0 15px rgba(0, 0, 0, 0.4);
      }
      .sidebar a {
        padding: 18px 30px;
        text-decoration: none;
        font-size: 1.1em;
        color: #f8f9fa;
        display: flex;
        align-items: center;
        transition: all 0.3s ease;
        font-weight: 500;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      }
      .sidebar a i {
        margin-right: 15px;
        font-size: 1.2em;
        color: var(--primary-color); /* Icon color - Burgundy */
      }
      .sidebar a:hover {
        color: var(--primary-light); /* Lighter Burgundy on hover */
        background-image: linear-gradient(to right, #4a4a4a, #5a5a5a); /* Soft dark gray gradient */
        padding-left: 35px;
        transform: translateX(5px);
      }
      .sidebar .closebtn {
        position: absolute;
        top: 20px;
        right: 25px;
        font-size: 40px;
        color: #f8f9fa;
        transition: all 0.3s ease;
      }
      .sidebar .closebtn:hover {
        color: #a02020; /* Darker red for close button */
        transform: rotate(90deg) scale(1.1);
      }

      /* Main Content Area */
      #mainContent {
        transition: margin-left 0.5s cubic-bezier(0.7, 0, 0.3, 1);
        padding: 30px;
        margin-left: 0;
      }

      /* Login Form Styles */
      .login-form {
        max-width: 480px;
        margin: 100px auto;
        padding: 45px;
        background: var(--card-bg);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-medium);
        text-align: center;
        animation: fadeInScale 0.8s ease-out;
      }
      @keyframes fadeInScale {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      .login-form h2 {
        font-family: "Poppins", sans-serif;
        color: var(--text-dark);
        margin-bottom: 25px;
        font-weight: 700;
        font-size: 2.2em;
      }
      .login-form p {
        color: var(--text-light);
        margin-bottom: 30px;
        font-size: 1.05em;
      }
      .login-form input {
        width: calc(100% - 30px);
        padding: 15px;
        margin: 12px 0;
        border: 1px solid #ced4da;
        border-radius: var(--border-radius-sm);
        font-size: 1.05em;
        transition: all 0.3s ease;
        background-color: var(--background-light);
      }
      .login-form input:focus {
        border-color: var(--primary-color); /* Burgundy border */
        box-shadow: 0 0 0 4px rgba(128, 0, 32, 0.25); /* Soft Burgundy shadow */
        outline: none;
        background-color: white;
      }
      .login-form button {
        width: 100%;
        padding: 16px;
        background-color: var(--primary-color);
        background-image: linear-gradient(to right, var(--primary-color), var(--primary-dark)); /* Burgundy gradient */
        color: white;
        border: none;
        border-radius: var(--border-radius-sm);
        cursor: pointer;
        font-size: 1.25em;
        font-weight: 600;
        margin-top: 25px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      .login-form button:hover {
        background-color: var(--primary-dark);
        background-image: linear-gradient(to right, var(--primary-dark), #4d0010); /* Darker Burgundy gradient */
        transform: translateY(-4px) scale(1.01);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      }
      .login-form #loginError {
        margin-top: 20px;
        font-weight: 600;
        color: #a02020; /* Darker red for error */
      }
      .monitoring-control {
        display: flex;
        align-items: center;
        gap: 15px;
        background-color: var(--background-dark);
        padding: 15px 20px;
        border-radius: var(--border-radius-md);
        margin-bottom: 15px;
      }
      .toggle-label {
        font-weight: 600;
        color: var(--text-dark);
        font-size: 1.1em;
      }
      .status-text {
        font-weight: 700;
        font-size: 1.1em;
        color: var(--primary-dark);
      }
      .last-active-info {
        font-size: 0.95em;
        color: var(--text-light);
        margin-bottom: 25px;
        background-color: #f8f9fa;
        padding: 10px 15px;
        border-radius: var(--border-radius-sm);
        border-left: 4px solid var(--secondary-color);
      }

      /* Styling untuk Toggle Switch */
      .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
      }
      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
      }
      input:checked + .slider {
        background-color: var(--primary-color);
      }
      input:focus + .slider {
        box-shadow: 0 0 1px var(--primary-color);
      }
      input:checked + .slider:before {
        transform: translateX(26px);
      }
      .slider.round {
        border-radius: 34px;
      }
      .slider.round:before {
        border-radius: 50%;
      }

      /* Dashboard Content Sections (feature pages) */
      .feature-page {
        display: none;
        max-width: 1200px;
        margin: 40px auto;
        padding: 35px;
        background-color: var(--card-bg);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-medium);
        animation: slideInUp 0.7s ease-out;
      }
      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(40px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .feature-page h3 {
        font-family: "Poppins", sans-serif;
        color: var(--text-dark);
        margin-top: 0;
        margin-bottom: 25px;
        font-size: 1.9em;
        font-weight: 600;
        border-bottom: 2px solid var(--background-dark);
        padding-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .feature-page h3 i {
        color: var(--primary-color); /* Burgundy icon color */
        font-size: 1.1em;
      }
      .feature-page p {
        margin-bottom: 18px;
        color: var(--text-light);
      }
      .feature-page ul {
        list-style: none;
        padding: 0;
        margin-top: 20px;
      }
      .feature-page ul li {
        background-color: var(--background-light);
        padding: 12px 18px;
        margin-bottom: 10px;
        border-left: 5px solid var(--primary-color); /* Highlight with Burgundy */
        border-radius: var(--border-radius-sm);
        font-size: 0.98em;
        color: var(--text-dark);
        transition: transform 0.2s ease;
      }
      .feature-page ul li:hover {
        transform: translateX(5px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      /* Specific Feature Styles */
      .rgb-values {
        display: grid; /* Use grid for better layout control */
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 20px;
        margin: 25px 0;
      }
      .rgb-box {
        padding: 25px 15px;
        border-radius: var(--border-radius-md);
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      .rgb-box::before {
        /* Subtle background pattern */
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: radial-gradient(circle, rgba(0, 0, 0, 0.05) 1px, transparent 1px);
        background-size: 10px 10px;
        opacity: 0.1;
        z-index: 0;
      }
      .rgb-box:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }
      .rgb-box strong {
        display: block;
        font-size: 1.1em;
        color: var(--text-light);
        margin-bottom: 10px;
        font-weight: 500;
        z-index: 1;
      }
      .rgb-box span {
        font-size: 2.2em;
        font-weight: 700;
        color: var(--text-dark);
        z-index: 1;
      }
      /* Specific RGB box colors - adjusted for Burgundy theme */
      .red {
        background-image: linear-gradient(to bottom right, #f0d0d0, #e0b0b0); /* Very soft red/pinkish for R */
        border: 1px solid #d0a0a0;
      }
      .green {
        background-image: linear-gradient(to bottom right, #e0f0e0, #c0e0c0); /* Soft green for G */
        border: 1px solid #a0d0a0;
      }
      .blue {
        background-image: linear-gradient(to bottom right, #d0e0f0, #b0c0e0); /* Soft blue for B */
        border: 1px solid #a0b0d0;
      }

      /* RGB Bar Visualization */
      .rgb-bar-container {
        display: flex;
        gap: 5px; /* Reduced gap for bars */
        margin-top: 20px;
        height: 30px;
        border-radius: var(--border-radius-sm);
        overflow: hidden;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        background-color: var(--background-dark); /* Background for empty bar space */
      }
      .rgb-bar {
        height: 100%;
        transition: width 0.5s ease-out;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 0.8em;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        flex-shrink: 0; /* Prevent bars from shrinking below content */
      }
      .rgb-bar.red-bar {
        background-color: #a02020;
      } /* Stronger red for bar */
      .rgb-bar.green-bar {
        background-color: #4caf50;
      } /* Stronger green for bar */
      .rgb-bar.blue-bar {
        background-color: #2196f3;
      } /* Stronger blue for bar */

      .status {
        font-size: 2.2em;
        font-weight: 700;
        text-align: center;
        padding: 25px;
        border-radius: var(--border-radius-md);
        margin-top: 25px;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }
      .status:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }
      /* Status colors - adjusted for Burgundy theme */
      .mentah {
        background-image: linear-gradient(to right, #d4edda, #c3e6cb); /* Soft green gradient */
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .setengah {
        background-image: linear-gradient(to right, #fff3cd, #ffeeba); /* Soft yellow gradient */
        color: #856404;
        border: 1px solid #ffeeba;
      }
      .matang {
        background-image: linear-gradient(to right, var(--primary-light), var(--primary-color)); /* Burgundy gradient for ripe */
        color: white; /* White text for better contrast on dark burgundy */
        border: 1px solid var(--primary-color);
      }

      .daun-status {
        font-size: 1.25em;
        text-align: center;
        margin-top: 25px;
        padding: 18px;
        background-color: var(--background-dark);
        border-radius: var(--border-radius-md);
        border: 1px solid #dee2e6;
        font-weight: 600;
        color: var(--text-dark);
        box-shadow: 0 1px 8px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
      }
      .daun-status:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .image-placeholder {
        width: 100%;
        height: 280px; /* Taller placeholder */
        background-color: var(--background-dark);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border: 2px dashed #adb5bd;
        border-radius: var(--border-radius-md);
        margin: 25px 0;
        color: var(--text-light);
        font-style: italic;
        font-size: 1.05em;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .image-placeholder:hover {
        background-color: #e0e7ed;
        border-color: var(--primary-color); /* Burgundy on hover */
        transform: translateY(-5px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
      }
      .image-placeholder::before {
        content: "📸";
        font-size: 3.5em;
        margin-bottom: 15px;
        color: #95a5a6;
      }

      .historical-data {
        max-height: 500px; /* Even more height for history */
        overflow-y: auto;
        border: 1px solid #e0e0e0;
        padding: 20px;
        border-radius: var(--border-radius-md);
        background-color: var(--background-light);
        font-size: 0.95em;
        color: var(--text-dark);
        line-height: 1.9;
        box-shadow: inset 0 1px 8px rgba(0, 0, 0, 0.05);
      }
      .historical-data::-webkit-scrollbar {
        width: 10px;
      }
      .historical-data::-webkit-scrollbar-track {
        background: var(--background-dark);
        border-radius: 10px;
      }
      .historical-data::-webkit-scrollbar-thumb {
        background: var(--text-light);
        border-radius: 10px;
        transition: background 0.3s ease;
      }
      .historical-data::-webkit-scrollbar-thumb:hover {
        background: var(--primary-color); /* Burgundy on scrollbar hover */
      }

      /* Notification Styles */
      #notification {
        position: fixed;
        top: 30px;
        right: 30px;
        padding: 18px 25px;
        background-color: var(--primary-color);
        background-image: linear-gradient(to right, var(--primary-color), var(--primary-dark)); /* Burgundy gradient */
        color: white;
        border-radius: var(--border-radius-md);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        display: none;
        z-index: 1000;
        font-weight: 600;
        animation: slideInRight 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards, fadeOut 0.5s 4.5s forwards;
        min-width: 280px;
        text-align: center;
        letter-spacing: 0.5px;
      }
      @keyframes slideInRight {
        from {
          transform: translateX(120%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        header h1 {
          font-size: 1.3em;
        }
        .hamburger-menu {
          margin-right: 15px;
          font-size: 1.8em;
        }
        .logout-btn {
          margin-left: 15px;
          padding: 8px 15px;
          font-size: 0.9em;
        }
        .login-form {
          margin: 60px auto;
          padding: 30px;
        }
        .feature-page {
          margin: 25px auto;
          padding: 20px;
        }
        .rgb-values {
          grid-template-columns: 1fr; /* Stack on small screens */
        }
        .rgb-box {
          padding: 20px 15px;
        }
        .rgb-box span {
          font-size: 1.8em;
        }
        .sidebar {
          padding-top: 15px;
        }
        .sidebar a {
          font-size: 1em;
          padding: 15px 20px;
        }
        .sidebar a i {
          margin-right: 10px;
        }
        .sidebar .closebtn {
          font-size: 35px;
          right: 15px;
          top: 10px;
        }
        #mainContent {
          padding: 15px;
        }
        #notification {
          top: 20px;
          right: 20px;
          left: 20px;
          padding: 15px;
          min-width: unset;
        }
        .feature-page h3 {
          font-size: 1.6em;
        }
        .status {
          font-size: 1.8em;
        }
        .image-placeholder {
          height: 220px;
        }
      }
    </style>
  </head>
  <body>
    <header id="mainHeader">
      <div class="hamburger-menu" id="openSidebarBtn">
        <i class="fas fa-bars"></i>
      </div>
      <h1>Rancang Bangun Pemantauan Kematangan Buah Pisang Cavendish dan Perubahan Warna Pada Daun Secara Real-Time Berbasis IoT</h1>
      <button class="logout-btn" id="logoutBtn">Logout</button>
    </header>

    <!-- Sidebar Navigation -->
    <div id="mySidebar" class="sidebar">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <a href="#" onclick="showFeature('userStatus')"><i class="fas fa-user"></i> Status Akses Pengguna</a>
      <a href="#" onclick="showFeature('colorDetection')"><i class="fas fa-palette"></i> Deteksi Warna Buah & Daun</a>
      <a href="#" onclick="showFeature('imageCapture')"><i class="fas fa-camera"></i> Pengambilan Gambar Otomatis</a>
      <a href="#" onclick="showFeature('realtimeMonitoring')"><i class="fas fa-chart-line"></i> Monitoring Real-Time</a>
      <a href="#" onclick="showFeature('internetConnection')"><i class="fas fa-wifi"></i> Koneksi Internet (IoT)</a>
      <a href="#" onclick="showFeature('powerSupply')"><i class="fas fa-battery-full"></i> Catu Daya Mandiri</a>
      <a href="#" onclick="showFeature('classification')"><i class="fas fa-brain"></i> Pemrosesan & Klasifikasi</a>
      <a href="#" onclick="showFeature('historicalData')"><i class="fas fa-history"></i> Riwayat Data Pemantauan</a>
    </div>

    <!-- Main Content Area -->
    <div id="mainContent">
      <!-- Login Form -->
      <div id="loginSection" class="login-form">
        <h2>Login Pengguna</h2>
        <!-- Kalimat "Untuk mengakses sistem monitoring, silakan login dengan akun terdaftar (contoh: username: admin, password: password)." telah dihapus dari sini -->
        <input type="text" id="username" placeholder="Username" required />
        <input type="password" id="password" placeholder="Password" required />
        <button onclick="login()">Login</button>
        <p id="loginError" style="color: #a02020; display: none">Username atau password salah!</p>
      </div>

      <!-- Feature Pages (Initially hidden) -->
      <div id="userStatus" class="feature-page">
        <h3><i class="fas fa-user"></i> Status Akses Pengguna</h3>
        <p>Selamat datang, <span id="userName" style="font-weight: 600; color: var(--primary-color)"></span>! Anda memiliki akses ke data pemantauan real-time.</p>
      </div>

      <div id="colorDetection" class="feature-page">
        <h3><i class="fas fa-palette"></i> Deteksi Warna Buah dan Daun (Sensor TCS3200)</h3>
        <p>Data RGB dari sensor TCS3200 untuk buah pisang Cavendish dan daun.</p>
        <div class="rgb-values">
          <div class="rgb-box red"><strong>Red</strong> <span id="rgbR">0</span></div>
          <div class="rgb-box green"><strong>Green</strong> <span id="rgbG">0</span></div>
          <div class="rgb-box blue"><strong>Blue</strong> <span id="rgbB">0</span></div>
        </div>
        <!-- New: RGB Bar Visualization -->
        <div class="rgb-bar-container">
          <div class="rgb-bar red-bar" id="rgbBarR" style="width: 0%"></div>
          <div class="rgb-bar green-bar" id="rgbBarG" style="width: 0%"></div>
          <div class="rgb-bar blue-bar" id="rgbBarB" style="width: 0%"></div>
        </div>
        <div class="daun-status"><strong>Kondisi Daun:</strong> <span id="daunStatus">Hijau (Sehat)</span></div>
      </div>

      <div id="imageCapture" class="feature-page">
        <h3><i class="fas fa-camera"></i> Pengambilan Gambar Otomatis (ESP32-CAM)</h3>
        <p>Gambar terkini dari kamera ESP32-CAM.</p>
        <div class="image-placeholder" id="buahImage">Placeholder Gambar Buah Pisang (Real-time dari ESP32-CAM)</div>
        <div class="image-placeholder" id="daunImage">Placeholder Gambar Daun Pisang (Real-time dari ESP32-CAM)</div>
      </div>

      <div id="realtimeMonitoring" class="feature-page">
        <h3><i class="fas fa-chart-line"></i> Monitoring Real-Time</h3>

        <div class="monitoring-control">
          <label for="monitoringToggle" class="toggle-label">Status Monitoring:</label>
          <label class="switch">
            <input type="checkbox" id="monitoringToggle" />
            <span class="slider round"></span>
          </label>
          <span id="monitoringStatusText" class="status-text">NONAKTIF</span>
        </div>
        <div class="last-active-info"><strong>Terakhir Diaktifkan:</strong> <span id="terakhirAktif">Belum pernah</span></div>

        <p>Status kematangan buah berdasarkan data sensor terakhir.</p>
        <div class="status" id="buahStatus">Menunggu Data...</div>
      </div>

      <div id="internetConnection" class="feature-page">
        <h3><i class="fas fa-wifi"></i> Koneksi Internet (Integrasi IoT)</h3>
        <p>Sistem terhubung via Wi-Fi bawaan ESP32-CAM. Status: <span style="color: var(--primary-color); font-weight: 600">Terhubung</span></p>
      </div>

      <div id="powerSupply" class="feature-page">
        <h3><i class="fas fa-battery-full"></i> Catu Daya Mandiri</h3>
        <p>Sumber daya: Baterai 18650 dengan Step Down 5V. Status: <span style="color: var(--primary-color); font-weight: 600">Stabil (Portabel untuk kebun)</span></p>
      </div>

      <div id="classification" class="feature-page">
        <h3><i class="fas fa-brain"></i> Pemrosesan dan Klasifikasi Otomatis</h3>
        <p>ESP32-CAM mengolah data sensor untuk klasifikasi:</p>
        <ul>
          <li>Mentah: Dominasi hijau (RGB: R rendah, G tinggi)</li>
          <li>Setengah Matang: Perpaduan hijau-kuning</li>
          <li>Matang: Dominasi kuning-kecoklatan (RGB: R tinggi, G sedang)</li>
        </ul>
        <p style="font-size: 0.9em; color: var(--text-light)">Hasil dikirim ke website untuk tampilan real-time.</p>
      </div>

      <div id="historicalData" class="feature-page">
        <h3><i class="fas fa-history"></i> Riwayat Data Pemantauan (Pemeliharaan Sistem)</h3>
        <p>Data historis (simulasi database MySQL/Firebase). Pembaruan otomatis setiap 5 detik.</p>
        <div class="historical-data" id="history">
          <!-- Historical data will be updated here -->
        </div>
        <p style="font-size: 0.9em; color: var(--text-light); margin-top: 15px">Fitur pengembangan: Notifikasi otomatis jika matang, analisis tren.</p>
      </div>
    </div>

    <!-- Notification -->
    <div id="notification"></div>

    <script type="module">
    // ===================================================================
    // === 1. KONFIGURASI DAN INISIALISASI FIREBASE ===
    // ===================================================================

    // Impor fungsi-fungsi yang dibutuhkan dari Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // --- PENTING: GANTI DENGAN KREDENSIAL ASLI DARI PROYEK FIREBASE KAMU ---
    const firebaseConfig = {
      apiKey: "AIzaSyAcs28O1Ug7oJw70RS3yygnguCiVHU5iVw",
      authDomain: "pemantau-pisang.firebaseapp.com",
      databaseURL: "https://pemantau-pisang-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "pemantau-pisang",
      storageBucket: "pemantau-pisang.appspot.com", // Ganti menjadi .firebasestorage.app jika ada error
      messagingSenderId: "402264135009",
      appId: "1:402264135009:web:e74cc3c4861188c3566120"
    };

    // Inisialisasi aplikasi Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    // --- CONSOLE LOG 1: Konfirmasi Inisialisasi ---
    console.log("Firebase app initialized. Attempting to connect to database...");

    // ===================================================================
    // === 2. DEFINISI REFERENSI PATH & ELEMEN HTML ===
    // ===================================================================
    const pathDataTerbaru = ref(db, 'pemantau-pisang/data_sensor/terbaru');
    const pathRiwayat = ref(db, 'pemantau-pisang/riwayat');
    const pathKontrolMonitoring = ref(db, 'pemantau-pisang/kontrol/monitoringAktif');
    const pathTerakhirAktif = ref(db, 'pemantau-pisang/status/terakhirAktif');
    const pathIpAddress = ref(db, 'pemantau-pisang/status/ipAddress');

    const monitoringToggle = document.getElementById('monitoringToggle');
    const monitoringStatusText = document.getElementById('monitoringStatusText');
    const terakhirAktifSpan = document.getElementById('terakhirAktif');
    const rgbR_span = document.getElementById('rgbR');
    const rgbG_span = document.getElementById('rgbG');
    const rgbB_span = document.getElementById('rgbB');
    const buahStatus_div = document.getElementById('buahStatus');
    const history_div = document.getElementById('history');
    const rgbBarR = document.getElementById('rgbBarR');
    const rgbBarG = document.getElementById('rgbBarG');
    const rgbBarB = document.getElementById('rgbBarB');
    const buahImage_div = document.getElementById('buahImage');
    
    // --- CONSOLE LOG 2: Konfirmasi Elemen HTML ditemukan ---
    console.log("HTML elements loaded.");

    // ===================================================================
    // === 3. FUNGSI REAL-TIME (LISTENER DARI FIREBASE) ===
    // ===================================================================

    // --- CONSOLE LOG 3: Konfirmasi Listener dipasang ---
    console.log("Attaching Firebase listeners...");

    const errorCallback = (error) => {
        // --- CONSOLE LOG 4: Menangkap error koneksi ---
        console.error("Firebase connection error:", error);
    };

    onValue(pathKontrolMonitoring, (snapshot) => {
        const isAktif = snapshot.val();
        // --- CONSOLE LOG 5: Menampilkan data yang diterima ---
        console.log("✅ Control status received from Firebase:", isAktif);
        if (monitoringToggle) {
            monitoringToggle.checked = isAktif;
            monitoringStatusText.textContent = isAktif ? "AKTIF" : "NONAKTIF";
        }
    }, errorCallback);

    onValue(pathTerakhirAktif, (snapshot) => {
        const data = snapshot.val();
        console.log("✅ 'Terakhir Aktif' data received:", data);
        if (terakhirAktifSpan) {
            terakhirAktifSpan.textContent = data || "Belum pernah";
        }
    }, errorCallback);

    onValue(pathDataTerbaru, (snapshot) => {
        const data = snapshot.val();
        console.log("SENSOR DATA RECEIVED:", data); // Log data sensor mentah
        if (data) {
            rgbR_span.textContent = data.merah;
            rgbG_span.textContent = data.hijau;
            rgbB_span.textContent = data.biru;
            
            const maxVal = 400; 
            rgbBarR.style.width = `${(data.merah / maxVal) * 100}%`;
            rgbBarG.style.width = `${(data.hijau / maxVal) * 100}%`;
            rgbBarB.style.width = `${(data.biru / maxVal) * 100}%`;
            rgbBarR.textContent = data.merah;
            rgbBarG.textContent = data.hijau;
            rgbBarB.textContent = data.biru;

            let statusClass = 'mentah';
            if (data.status === 'MATANG') statusClass = 'matang';
            else if (data.status === 'SETENGAH MATANG') statusClass = 'setengah';
            
            buahStatus_div.textContent = data.status;
            buahStatus_div.className = `status ${statusClass}`;
        }
    }, errorCallback);
    
    onValue(pathRiwayat, (snapshot) => {
        const riwayat = snapshot.val();
        if(riwayat){
            let keys = Object.keys(riwayat).slice(-15);
            console.log(`✅ History data received. Displaying last ${keys.length} entries.`);
        }
    }, errorCallback);
    
    onValue(pathIpAddress, (snapshot) => {
        const ip = snapshot.val();
        console.log("✅ IP Address for camera stream received:", ip);
        if (ip && buahImage_div) {
            buahImage_div.innerHTML = `<img src="http://${ip}:81/stream" style="width:100%; height:100%; border-radius:12px; object-fit:cover;" />`;
        }
    }, errorCallback);

    // ===================================================================
    // === 4. FUNGSI KONTROL (EVENT LISTENER KE FIREBASE) ===
    // ===================================================================

    if (monitoringToggle) {
        monitoringToggle.addEventListener('change', (event) => {
            const isChecked = event.target.checked;
            // --- CONSOLE LOG 6: Konfirmasi perintah dikirim ---
            console.log("📤 Sending command to Firebase: monitoringAktif =", isChecked);
            set(pathKontrolMonitoring, isChecked);

            if (isChecked) {
                const waktuSekarang = new Date().toLocaleString('id-ID', {
                    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
                    hour: '2-digit', minute: '2-digit', timeZone: 'Asia/Makassar'
                });
                console.log("📤 Sending 'Terakhir Aktif' timestamp to Firebase:", waktuSekarang);
                set(pathTerakhirAktif, waktuSekarang);
            }
        });
    }

    // ===================================================================
    // === 5. FUNGSI-FUNGSI UI LAMA (LOGIN, SIDEBAR, DLL) ===
    // ===================================================================
    
    let currentUser = null;
    let activeFeature = "";

    window.login = function() {
        // ... (kode fungsi login lama tidak perlu diubah) ...
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        if (username === "admin" && password === "password") {
            currentUser = username;
            document.getElementById("userName").textContent = username;
            document.getElementById("loginSection").style.display = "none";
            document.getElementById("openSidebarBtn").style.display = "block";
            document.getElementById("logoutBtn").style.display = "block";
            showFeature("userStatus");
            showNotification("Login berhasil! Selamat memantau.");
        } else {
            document.getElementById("loginError").style.display = "block";
        }
    };

    document.getElementById("logoutBtn").onclick = function () {
        // ... (kode fungsi logout lama tidak perlu diubah) ...
        currentUser = null;
        document.getElementById("loginSection").style.display = "block";
        document.getElementById("openSidebarBtn").style.display = "none";
        document.getElementById("logoutBtn").style.display = "none";
        const featurePages = document.querySelectorAll(".feature-page");
        featurePages.forEach((page) => (page.style.display = "none"));
        document.getElementById("username").value = "";
        document.getElementById("password").value = "";
        document.getElementById("loginError").style.display = "none";
        closeNav();
        showNotification("Anda telah logout.");
    };

    window.openNav = function() {
        document.getElementById("mySidebar").style.width = "250px";
    };

    window.closeNav = function() {
        document.getElementById("mySidebar").style.width = "0";
    };

    window.showFeature = function(featureId) {
        const featurePages = document.querySelectorAll(".feature-page");
        featurePages.forEach((page) => (page.style.display = "none"));
        const selectedFeature = document.getElementById(featureId);
        if (selectedFeature) {
            selectedFeature.style.display = "block";
            activeFeature = featureId;
        }
        closeNav();
    };

    window.showNotification = function(message) {
        const notif = document.getElementById("notification");
        if (notif) {
            notif.textContent = message;
            notif.style.display = 'block';
            notif.style.animation = 'none';
            void notif.offsetWidth;
            notif.style.animation = 'slideInRight 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards, fadeOut 0.5s 4.5s forwards';
        }
    };

    document.addEventListener("keypress", function (e) {
        if (e.key === "Enter" && document.getElementById("loginSection").style.display !== "none") {
            login();
        }
    });

    window.addEventListener("scroll", function () {
        const header = document.getElementById("mainHeader");
        if (window.scrollY > 0) {
            header.classList.add("scrolled");
        } else {
            header.classList.remove("scrolled");
        }
    });

    document.addEventListener("DOMContentLoaded", () => {
        const featurePages = document.querySelectorAll(".feature-page");
        featurePages.forEach((page) => (page.style.display = "none"));
        document.getElementById("loginSection").style.display = "block";
        document.getElementById("openSidebarBtn").style.display = "none";
        document.getElementById("logoutBtn").style.display = "none";
        document.getElementById("openSidebarBtn").onclick = openNav;
    });

</script>
  </body>
</html>
